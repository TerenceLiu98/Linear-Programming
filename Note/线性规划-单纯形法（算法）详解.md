# 线性规划-单纯形法（算法）详解



### 線性規劃標準形式

標準形式如下：

$\begin{align*} min \ \ c^Tx \\ s.t. Ax \leq b  \\ x\geq 0 \end{align*}$

就是

* 求的是 $min$ 
* 所有的約束為 $\leq$ 的形式
* 所有的變量 $\geq 0$

如何變成標準形式呢？

* 原來是 $max$ ,直接$\times -1$ 求 $min$
* 若原來約束為 = ，轉為 $\leq$ 或 $\geq$ 
* 約束原來 $\geq$ 同樣$\times -1$ 就變成了 $\leq$ 
* 若變量$x_i<0$ ，那麼就用$x'-x''$ 替代



### 線性規劃鬆弛形式

鬆弛形式為：

$\begin{align*} min\ \ c^Tx \\ s.t. \ Ax=b \\ x\geq 0 \end{align*}$

就是把引入變量把原來的 $\leq$ 變成了 $=$ 的鬆弛形式

如：

$\begin{align*}x_1 + x_2 \leq 2 \\ x_1 + x_2 \leq 1 \\ x_1, \ x_2 \geq 0\end{align*}$

寫成鬆弛形式：

$\begin{align*}x_1 + x_2 +x_3 =  2 \\ x_1 + x_2 +x_4 = 1 \\ x_1, \ x_2 ,x_3, x_4\geq 0\end{align*}$

## 单纯形算法的思想和例子

三个步骤：

1. 找到一个初始的基本可行解
2. 不断的进行旋转（pivot）操作
3. 重复 2 直到结果不能改进为止

举个例子：

$\begin{align*}min \ \ -x_1-14x_2 - 6x_3 \\ s.t. x_1 + x_2 + x_3 \leq 4 \\ x_1 \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \  \leq 2\\x_3\leq 3\\ 3x_2 + x_3\leq 6 \\ x_1, x_2, x_3 \geq 0\end{align*}$

將其寫成鬆弛形式：

$\begin{align*}min \ \ -x_1-14x_2 - 6x_3 \\ s.t. x_1 + x_2 + x_3 + x_4 \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ = 4 \\ x_1 \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +x_5\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ = 2\\x_3 +\ \ \ \ \ \ \ \ \ \  \ \ \ \ +x_6\ \ \ \ \ \ \ \ \ = 3 \\ 3x_2 + x_3+ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +x_7= 6 \\ x_1, x_2, x_3,x_4,x_5,x_6,x_7 \geq 0 \end{align*}$

其實，就等價於：

$\begin{align*}&z = -x_1 - 14x_2 -6 x_3\\&x_4 = 4-x_1 -x_2 - x_3\\& x_5 = 2-x_1\\&x_6 = 3-x_3\\&x_7= 6-3x_2-3x_3 \end{align*}$

在上述的等式的左邊稱為**基本變量**，而右邊稱為**非基本變量**

現在來考慮**基本解**就是把等式右邊的所有非基本變量設為 $0$，然後計算左邊的基本變量的值。

這裡，容易得到基本解為：$(x_1,x_2,\dots,x_7) = (0,0,0,4,2,3,6)$， 然後目標值為 $z = 0$，其實就是把基本比昂量 $x_i $ 設置為 $b_i$ 。

一般來說，基本解是可行的，我們稱之為**基本可行解**。 初始化的基本解不可行的情況件後面的討論，這裡假設出事的基本解就是基本可行解，第一步完成。

**第二個步驟** pivoting step

我們每次選擇一個在目標函數中的係數為負的飛機本變量 $x_e$，然後盡可能增加 $x_e$ 的值（不違反約束），並將 $x_e$ 用基本變量 $x_i$ 去表示成基本變量，$\Rightarrow$ 這時， $x_i$ 就會變成非基本變量

（*pivot 的意思就是將用非基本變量去替換基本變量*）

這裡，我們假設選擇 $x_1$，那麼在上述的等式（不包括目標函數）中，第一個等式限制了 $x_1\leq 4$ ，第二個等式有更加嚴格（也是最嚴格）的限制，它限制了 $x_1 \leq 2$ ，因此我們最多將 $x_1$ 增加到 $2$ ，根據上面的第二個等式，我們有：$x_1=2-x_5$ ，帶入上面（目標函數）就實現了 $x_e$ 和 $x_i$ 的替換了：

 $\begin{align*}&z =-2 - 14x_2- 6x_3 + x_5\\&x_4 = 4-x_1 -x_2 - x_3\\& x_1 = 2-x_5\\&x_6 = 3-x_3\\&x_7= 6-3x_2-3x_3 \end{align*}$

這就是一個 pivoting step:  一次轉東選取一個**非基本變量** $x_e$ 和一個**基本變量** $x_i$，然後替換兩者的角色。pivot 一次得到的等式和原來等價。

接下來就是**第三步**了，就是不斷的進行 pivoting，直到無法進行改進位置，繼續看剛才的例子：

我們接著執行轉動，這次我們可以選擇增大 $x_2$ 或者 $x_3$ ，但是不能選擇 $x_5$，因為增大 $x_5$ 之後，$z$ 也會增大，而我們要求的是 minimize the $z$ 。假設選擇了 $x_2$ 那麼第一個等式限制了 $x_2 \leq 2$，第四個等式限制了 $x_2 \leq 2 $，因為第四個等式非基本變量較少，選擇第四個 $\Rightarrow$ $x_2 = 2 - x_3 - x_4 + x_5$，帶入得：

$\begin{align*}&z =-30 + 8x_3 + 14x_4 -13x_5\\&x_2 = 2-x_3 -x_4 + x_5\\& x_1 = 2-x_5\\&x_6 = 3-x_3\\&x_7= 6-3x_2-3x_5 \end{align*}$

此時，我們的基本解變成了$(x_1,x_2,\dots,x_7) = (2,2,0,0,0,3,0), z = -30$ 

我們這是要選擇 $x_5$ ，第四個等式具有最嚴格的限制，我們有 $x_5 = \frac{2}{3}x_3 + x_4 -\frac{1}{3} x_7$ 帶入得：

$\begin{align*}&z =-30 - \frac{2}{3}x_3 + x_4 -\frac{13}{3}x_7\\&x_2 = 2-\frac{1}{3}x_3 -\frac{1}{3}x_7\\& x_1 = 2-\frac{2}{3}x_3 - x_4 + \frac{1}3x_7\\&x_6 = 3-x_3\\&x_5= \frac{2}{3}x_3 + x_4 -\frac{1}{3} x_7 \end{align*}$

此時，我們的基本解變成了$(x_1,x_2,\dots,x_7) = (2,2,0,0,0,3,0), z =-30$ , 這時候並沒有增加，但是下一步，我們可以選擇增加$x_3$。 第 $2$ 個和第 $3$ 個有最嚴格的限制，我們選第二個的話，得：$x_3= 3-\frac{3}{2}x_1 - \frac{3}{2}x_4 + \frac{1}{2}x_7$ ，然后带入：

$\begin{align*}&z =-32 +x_1 +2x_4 + 4x_7\\&x_2 = 1 + \frac{1}{2}x_3 + \frac{1}{2}x_4-\frac{1}{2}x_7\\& x_3 = 3-\frac{3}{2}x_1 - \frac{3}{2}x_4 + \frac{1}{2}x_7\\&x_6 = \frac{3}{2}x_1 + \frac{3}{2}x_4 - [frac{1}{2}x_7\\&x_5= 2 - x_1 \end{align*}$

現在，已經沒有可以繼續增大的值了，停止 pivoting，$z = 32$ 就是我們的解，而此時，基本解為: $(x_1, x_2, \dots,x_7) = (0,1,3,0,2,0,0)$ 帶入表達式 $\Rightarrow$ $z =-32$  得到目標值

 

## 退化（Degeneracy）

在我們 pivot 的古城中，可能存在保持目標值不變的情況，這種現象稱為退化。比如上述例子中兩次等於 $-30$ 

可以說退化可能導致**循環（cycling）**的情況，這是使得單純形算法不會終止的唯一原因。還好上面例子中，我們沒有產生多次循環的情況，再次 pivot，目標值繼續降低。

**如何避免退化？** $\Rightarrow$ 使用**Bland法則**

在選擇替入變量和換出變量的時候，我們總是選擇滿足條件的下標最小值。

* 替入變量 $x_e$：目標條件中，係數為負數的第一個作為替入變量；
* 替出變量 $x_i$：對所有的約束條件，選擇對 $x_e$ 約束最緊的第一個

